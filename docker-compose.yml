services:
  docs-builder:
    build:
      context: .
      dockerfile: docs/Dockerfile.build
    container_name: wealthfolio-docs-builder
    profiles:
      - build

  docs:
    image: node:20-alpine
    container_name: wealthfolio-docs-server
    working_dir: /app/docs
    ports:
      - "3001:3001"
    volumes:
      - ./docs:/app/docs
      - ./src:/app/src
      - ./src-tauri:/app/src-tauri
      - ./src-server:/app/src-server
      - ./src-core:/app/src-core
      - ./packages:/app/packages
      - ./package.json:/app/package.json
      - ./pnpm-workspace.yaml:/app/pnpm-workspace.yaml
      - ./pnpm-lock.yaml:/app/pnpm-lock.yaml
      - ./node_modules:/app/node_modules
    environment:
      - NODE_OPTIONS=--max-old-space-size=4096
    command: >
      sh -c "
        npm install -g pnpm &&
        pnpm install --frozen-lockfile &&
        node scripts/sync-docs.js &&
        node scripts/generate-api-docs.js &&
        pnpm start
      "
